<div class="slides-container">
  <!-- Error Messages -->
  @if (errorMessage()) {
  <div class="alert alert-error">
    {{ errorMessage() }}
  </div>
  }

  <!-- Loading Overlay -->
  @if (isSubmitting()) {
  <div class="loading-overlay">
    <div class="loading-spinner"></div>
    <p>{{ 'savingTasting' | translate }}</p>
  </div>
  }

  <!-- Redirecting Overlay with Coffee Animation -->
  @if (isRedirecting()) {
  <div class="redirecting-overlay">
    <div class="coffee-loading-container">
      <div class="coffee-cup">
        <div class="coffee-liquid"></div>
        <div class="coffee-steam">
          <div class="steam steam-1"></div>
          <div class="steam steam-2"></div>
          <div class="steam steam-3"></div>
        </div>
      </div>
      <div class="coffee-beans">
        <div class="bean bean-1"></div>
        <div class="bean bean-2"></div>
        <div class="bean bean-3"></div>
      </div>
    </div>
    <p class="redirecting-text">{{ getRedirectingMessage() }}</p>
  </div>
  }

  <div class="slides-wrapper">
    <!-- Slides -->
    <div class="slides-content">
      @for (slide of slides; track slide.id) {
      <div
        class="slide"
        [class.active]="currentSlide() === slide.id"
        [class.prev]="currentSlide() > slide.id"
        [class.next]="currentSlide() < slide.id"
        role="tabpanel"
      >
        <div class="slide-inner">
          <!-- Paso 1: Identidad del Café -->
          @if (slide.id === 0) {
          <app-coffee-identity-slide
            [coffeeData]="coffeeIdentity()"
            [beanTypes]="beanTypes"
            (dataChange)="onIdentityChange($event)"
          />
          }
          <!-- Paso 2: Tueste y Preparación -->
          @if (slide.id === 1) {
          <app-coffee-roast-slide
            [coffeeData]="coffeeRoast()"
            [roastLevels]="roastLevels"
            [brewMethodsOptions]="brewMethodsOptions"
            (roastLevelChange)="onRoastLevelChange($event)"
            (brewMethodChange)="onBrewMethodChange($event)"
            (formSubmit)="onFormSubmit()"
          />
          }

          <!-- Paso 3: Notas Sensoriales -->
          @if (slide.id === 2) {
          <app-coffee-sensory-slide
            [sensoryData]="coffeeSensory()"
            [bodyLevels]="bodyLevels"
            (sensoryChange)="onSensoryChange($event)"
          />
          }
          <!-- Paso 4: Notas Sensoriales -->
          @if (slide.id === 3) {
          <app-coffee-flavor-slide
            [flavorData]="coffeeFlavor()"
            [acidityLevels]="acidityLevels"
            [afterTasteLevels]="afterTasteLevels"
            (flavorChange)="onFlavorChange($event)"
          />
          }
          <!-- Paso 5: Calification -->
          @if (slide.id === 4) {
          <app-coffee-score-slide
            [scoreData]="coffeeScore()"
            (scoreChange)="onScoreChange($event)"
            (imageChange)="onImageChange($event)"
            (saveForm)="onSaveCoffeeForm()"
          />
          }
        </div>
      </div>
      }
    </div>
  </div>

  <div class="slide-indicators-container">
    <!-- Indicadores de slides -->
    <div class="slide-indicators" role="tablist" aria-label="Pasos del formulario">
      @for (slide of slides; track slide.id) {
      <button
        class="indicator"
        role="tab"
        [class.active]="currentSlide() === slide.id"
        [class.completed]="isSlideCompleted(slide.id)"
        [class.invalid]="!isSlideCompleted(slide.id) && slide.id < currentSlide()"
        [attr.aria-selected]="currentSlide() === slide.id"
        [attr.aria-label]="('stepLabel' | translate) + ' ' + (slide.id + 1) + ': ' + slide.title"
        [attr.title]="
          !isSlideCompleted(slide.id) && slide.id < currentSlide()
            ? ('incompleteStep' | translate)
            : slide.title
        "
        (click)="goToSlide(slide.id)"
        type="button"
      >
        @if (isSlideCompleted(slide.id)) {
        <span class="check-icon">✓</span>
        } @else if (!isSlideCompleted(slide.id) && slide.id < currentSlide()) {
        <span class="error-icon">⚠</span>
        }
      </button>
      }
    </div>
  </div>
  <div class="coffee-bean bean-1"></div>
  <div class="coffee-bean bean-2"></div>
  <div class="coffee-bean bean-3"></div>
  <div class="coffee-bean bean-4"></div>
</div>
