<div class="slides-container">
  <!-- Success/Error Messages -->
  @if (successMessage()) {
  <div class="alert alert-success">
    {{ successMessage() }}
  </div>
  } @if (errorMessage()) {
  <div class="alert alert-error">
    {{ errorMessage() }}
  </div>
  }

  <!-- Post-Save Options -->
  @if (showPostSaveOptions()) {
  <div class="post-save-options">
    <div class="options-container">
      <h3>Â¿QuÃ© quieres hacer ahora?</h3>
      <div class="options-buttons">
        <button class="option-btn same-coffee" (click)="onNewTastingWithSameCoffee()">
          <span class="icon">â˜•</span>
          <span class="text">Nueva cata con el mismo cafÃ©</span>
          <span class="description">Mantiene la informaciÃ³n del cafÃ©, solo cambia las notas sensoriales</span>
        </button>
        <button class="option-btn new-coffee" (click)="onNewTastingFromScratch()">
          <span class="icon">ğŸ†•</span>
          <span class="text">Nueva cata desde cero</span>
          <span class="description">Comienza con un cafÃ© completamente nuevo</span>
        </button>
        <button class="option-btn dashboard" (click)="onGoToDashboard()">
          <span class="icon">ğŸ“Š</span>
          <span class="text">Ir al Dashboard</span>
          <span class="description">Ver todas tus catas guardadas</span>
        </button>
      </div>
    </div>
  </div>
  }

  <!-- Loading Overlay -->
  @if (isSubmitting()) {
  <div class="loading-overlay">
    <div class="loading-spinner"></div>
    <p>Guardando tu cata...</p>
  </div>
  }

  <div class="slides-wrapper">
    <!-- Slides -->
    <div class="slides-content">
      @for (slide of slides; track slide.id) {
      <div
        class="slide"
        [class.active]="currentSlide() === slide.id"
        [class.prev]="currentSlide() > slide.id"
        [class.next]="currentSlide() < slide.id"
        role="tabpanel"
        [attr.aria-hidden]="currentSlide() !== slide.id"
      >
        <div class="slide-inner">
          <!-- Paso 1: Identidad del CafÃ© -->
          @if (slide.id === 0) {
          <app-coffee-identity-slide
            [coffeeData]="coffeeIdentity()"
            [beanTypes]="beanTypes"
            (dataChange)="onIdentityChange($event)"
          />
          }
          <!-- Paso 2: Tueste y PreparaciÃ³n -->
          @if (slide.id === 1) {
          <app-coffee-roast-slide
            [coffeeData]="coffeeRoast()"
            [roastLevels]="roastLevels"
            [brewMethodsOptions]="brewMethodsOptions"
            (roastLevelChange)="onRoastLevelChange($event)"
            (brewMethodChange)="onBrewMethodChange($event)"
            (formSubmit)="onFormSubmit()"
          />
          }

          <!-- Paso 3: Notas Sensoriales -->
          @if (slide.id === 2) {
          <app-coffee-sensory-slide
            [sensoryData]="coffeeSensory()"
            [bodyLevels]="bodyLevels"
            (sensoryChange)="onSensoryChange($event)"
          />
          }
          <!-- Paso 4: Notas Sensoriales -->
          @if (slide.id === 3) {
          <app-coffee-flavor-slide
            [flavorData]="coffeeFlavor()"
            [acidityLevels]="acidityLevels"
            [afterTasteLevels]="afterTasteLevels"
            (flavorChange)="onFlavorChange($event)"
          />
          }
          <!-- Paso 5: Calification -->
          @if (slide.id === 4) {
          <app-coffee-score-slide
            [scoreData]="coffeeScore()"
            (scoreChange)="onScoreChange($event)"
            (imageChange)="onImageChange($event)"
            (saveForm)="onSaveCoffeeForm()"
          />
          }
        </div>
      </div>
      }
    </div>
  </div>

  <div class="slide-indicators-container">
    <!-- Indicadores de slides -->
    <div class="slide-indicators" role="tablist" aria-label="Pasos del formulario">
      @for (slide of slides; track slide.id) {
      <button
        class="indicator"
        role="tab"
        [class.active]="currentSlide() === slide.id"
        [class.completed]="isSlideCompleted(slide.id)"
        [class.invalid]="!isSlideCompleted(slide.id) && slide.id < currentSlide()"
        [attr.aria-selected]="currentSlide() === slide.id"
        [attr.aria-label]="'Paso ' + (slide.id + 1) + ': ' + slide.title"
        [attr.title]="
          !isSlideCompleted(slide.id) && slide.id < currentSlide()
            ? 'Este paso tiene campos incompletos'
            : slide.title
        "
        (click)="goToSlide(slide.id)"
        type="button"
      >
        @if (isSlideCompleted(slide.id)) {
        <span class="check-icon">âœ“</span>
        } @else if (!isSlideCompleted(slide.id) && slide.id < currentSlide()) {
        <span class="error-icon">âš </span>
        }
      </button>
      }
    </div>
  </div>
</div>
