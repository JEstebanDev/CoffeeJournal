<div class="dashboard-container">
  <!-- Header -->
  <app-header></app-header>

  <!-- Main Content -->
  <main class="dashboard-main">
    <!-- Router outlet for child routes (like coffee form) -->
    <router-outlet></router-outlet>
    <!-- Dashboard content (only shown when no child route is active) -->
    @if (!isChildRouteActive()) {
    <div class="dashboard-content">
      <!-- Welcome Section -->
      @if (!isLoading() && totalTastings() !== 0) {
      <section class="welcome-section">
        <h1 class="welcome-title">
          <ng-container i18n="@@welcomeMessage">¡Bienvenido de nuevo, </ng-container>
          <span class="highlight">{{ userName() }}</span
          >!
        </h1>
        <p class="welcome-subtitle" i18n="@@dashboardSubtitle">
          Aquí está el resumen de tu viaje cafetero
        </p>

        <button class="new-tasting-btn" (click)="onNewTasting()">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path
              d="M12 5v14M5 12h14"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
          <ng-container i18n="@@newTastingButton">Nueva Cata</ng-container>
        </button>
      </section>
      }

      <!-- Loading State -->
      @if (isLoading()) {
      <div class="loading-container">
        <div class="spinner"></div>
        <p i18n="@@loadingMessage">Cargando tus datos...</p>
      </div>
      }

      <!-- Empty State - No tastings yet -->
      @if (!isLoading() && totalTastings() === 0) {
      <section class="empty-state">
        <div class="empty-state-content">
          <div class="empty-state-icon">
            <i data-lucide="coffee" class="coffee-icon-large"></i>
          </div>
          <h2 class="empty-state-title" i18n="@@emptyStateTitle">¡Comienza tu Viaje Cafetero!</h2>
          <p class="empty-state-description" i18n="@@emptyStateDescription">
            Coffee Journal es tu compañero perfecto para registrar y evaluar cada taza de café que
            pruebes. <br /><br />Documenta el origen, método de preparación, notas de sabor y
            califica cada experiencia para perfeccionar tu paladar y descubrir tus cafés favoritos.
          </p>
          <button class="new-tasting-btn" (click)="onNewTasting()">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path
                d="M12 5v14M5 12h14"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>
            <ng-container i18n="@@newTastingButton">Crear Cata de Café</ng-container>
          </button>
        </div>
      </section>
      }

      <!-- Stats Grid - Only show when there are tastings -->
      @if (!isLoading() && totalTastings() > 0) {
      <app-stats-grid
        [totalTastings]="totalTastings()"
        [topOrigins]="topOrigins()"
        [favoriteRoast]="favoriteRoast()"
        [favoriteBrewMethod]="favoriteBrewMethod()"
        [tastingTrend]="tastingTrend()"
      ></app-stats-grid>
      }

      <!-- Recent Tastings - Only show when there are tastings -->
      @if (!isLoading() && totalTastings() > 0) {
      <section class="recent-tastings">
        <div class="section-header">
          <h2 i18n="@@recentTastingsTitle">Mis Catas de Café</h2>

          <!-- Filtro de búsqueda -->
          <div class="search-filter">
            <div class="search-input-wrapper">
              <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <circle cx="11" cy="11" r="8" stroke-width="2" />
                <path d="m21 21-4.35-4.35" stroke-width="2" stroke-linecap="round" />
              </svg>
              <input
                type="text"
                class="search-input"
                placeholder="Buscar por nombre o marca..."
                [value]="searchQuery()"
                (input)="onSearchChange($event)"
                i18n-placeholder="@@searchPlaceholder"
              />
              @if (searchQuery()) {
              <button class="clear-search-btn" (click)="clearSearch()" type="button">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                  <line x1="18" y1="6" x2="6" y2="18" stroke-width="2" stroke-linecap="round" />
                  <line x1="6" y1="6" x2="18" y2="18" stroke-width="2" stroke-linecap="round" />
                </svg>
              </button>
              }
            </div>
          </div>
        </div>

        @if (isLoading()) {
        <div class="loading-state">
          <div class="spinner"></div>
          <p i18n="@@loadingMessage">Cargando tus catas...</p>
        </div>
        } @else if (errorMessage()) {
        <div class="error-state">
          <p>{{ errorMessage() }}</p>
          <button class="retry-btn" (click)="loadDashboardData()">
            <ng-container i18n="@@retryButton">Reintentar</ng-container>
          </button>
        </div>
        } @else if (filteredTastings().length > 0) {
        <div class="tastings-grid">
          @for (tasting of filteredTastings(); track tasting.id) {
          <app-tasting-card
            [tasting]="tasting"
            (cardClick)="onViewTasting($event)"
          ></app-tasting-card>
          }
        </div>
        } @else {
        <div class="empty-state">
          @if (searchQuery()) {
          <!-- Estado cuando no hay resultados de búsqueda -->
          <svg class="empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <circle cx="11" cy="11" r="8" stroke-width="2" />
            <path d="m21 21-4.35-4.35" stroke-width="2" stroke-linecap="round" />
            <line x1="11" y1="8" x2="11" y2="14" stroke-width="2" stroke-linecap="round" />
            <circle cx="11" cy="17" r="0.5" fill="currentColor" stroke="none" />
          </svg>
          <h3 i18n="@@noResultsTitle">No se encontraron resultados</h3>
          <p i18n="@@noResultsMessage">No hay catas que coincidan con "{{ searchQuery() }}"</p>
          <button class="cta-button secondary" (click)="clearSearch()">
            <ng-container i18n="@@clearSearchButton">Limpiar Búsqueda</ng-container>
          </button>
          } @else {
          <!-- Estado cuando no hay resultados de búsqueda pero sí hay catas -->
          <svg class="empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <circle cx="11" cy="11" r="8" stroke-width="2" />
            <path d="m21 21-4.35-4.35" stroke-width="2" stroke-linecap="round" />
            <line x1="11" y1="8" x2="11" y2="14" stroke-width="2" stroke-linecap="round" />
            <circle cx="11" cy="17" r="0.5" fill="currentColor" stroke="none" />
          </svg>
          <h3 i18n="@@noResultsTitle">No se encontraron resultados</h3>
          <p i18n="@@noResultsMessage">Intenta con otro término de búsqueda</p>
          <button class="cta-button secondary" (click)="clearSearch()">
            <ng-container i18n="@@clearSearchButton">Limpiar Búsqueda</ng-container>
          </button>
          }
        </div>
        }
      </section>
      }
    </div>
    <!-- End dashboard-content -->
    }
  </main>

  <!-- Insight Toast - Show when there are insights
  @if (!isLoading() && insights().length > 0) {
    <app-insight-toast [insights]="insights()"></app-insight-toast>
  }
  -->
</div>
